---
platform: linux
image_resource:
  type: docker-image
  source:
    repository: openstax/nebuchadnezzar
    tag: latest

inputs:
  - name: workflow-events-queued
  - name: s3-job-dir
outputs:
  - name: book

run:
  path: /bin/bash
  args:
    - -cxe
    - |
      exec 2> >(tee book/stderr >&2)
      rm -f s3-job-dir/stderr
      neb assemble "s3-job-dir/$(cat workflow-events-queued/id)/book" "./book"
